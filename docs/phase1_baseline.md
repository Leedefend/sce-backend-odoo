# Phase 1 基线说明（v0.1.0）

## 一、阶段定位

Phase 1 是 **Smart Construction 2.0** 的第一个稳定基线版本。

本阶段目标不是功能全面，而是**确立一条可长期演进的主业务链路与系统范式**，为后续审批流、扩展模块和产品化打下稳定基础。

该基线已合并至 `main` 分支，并打 Tag：`v0.1.0-phase1`。

---

## 二、已覆盖范围（Scope）

### 1️⃣ 权限与角色体系

* 建立 **能力组（Capability Group）驱动的权限模型**
* 能力组按业务域划分：

  * 项目中心（project）
  * 物资中心（material）
  * 采购中心（purchase）
  * 成控中心（cost）
  * 合同中心（contract）
  * 财务中心（finance）
  * 数据中心（data）
  * 配置管理员（config）
* 每个业务域区分：

  * 只读（read）
  * 经办（user）
  * 审批（manager）

权限控制已在三层统一生效：

* 菜单可见性（menu groups）
* 视图与按钮可用性（views / attrs / groups）
* 后端动作硬校验（Python `has_group`）

原有 `Smart Construction User / Manager` 已被废弃，仅保留为历史占位，不再授予任何实际权限。

---

### 2️⃣ 主业务流程（Mainflow）

已跑通并可实际使用的核心链路：

* 物资计划（Material Plan）

  * 编制 / 提交 / 审批 / 完成 / 取消
  * 明细状态锁定与只读控制
* 采购追溯

  * 由物资计划生成 RFQ / 采购单
  * 采购单与明细反向追溯物资计划
* 结算中心（Settlement）

  * 项目结算单模型
* 付款申请（Payment Request）

  * 申请 / 审批 / 状态控制
  * 权限与财务能力组严格绑定

---

### 3️⃣ UI 与数据一致性

* 菜单、按钮、模型访问权限完全对齐能力组
* 不同角色登录后看到的系统结构不同但逻辑一致
* 已提供多角色测试用户，支持快速验证权限组合

---

## 三、关键设计决策（Key Design Decisions）

### 1️⃣ 能力组优先于角色

* **能力组是权限的唯一来源**
* 角色只是能力组的组合与语义封装
* 禁止直接依赖「经理 / 用户」这类泛角色控制权限

---

### 2️⃣ 权限必须三层一致

任何一个动作，必须同时满足：

1. 菜单可见
2. UI 可操作
3. 后端允许执行

任何一层放权，视为权限漏洞。

---

### 3️⃣ Phase 1 只解决“主线正确”

* 不追求功能完整
* 不引入复杂审批配置
* 不做跨项目汇总或外部集成

优先保证：

> **一条真实业务可以从头走到尾，不塌、不乱、不越权**

---

## 四、明确不在本阶段的内容（Out of Scope）

以下内容刻意不在 Phase 1 实现范围内：

* 通用审批流 / 工作流引擎
* 多级、可配置审批规则
* 跨项目数据汇总
* 复杂财务核算逻辑
* 外部系统对接（ERP / 银行 / 电子签章）

这些能力将在 Phase 2 之后逐步引入。

---

## 五、下一阶段方向（Phase 2）

Phase 2 的唯一主线是：

> **工作流 / 审批引擎（Workflow Engine）**

核心目标：

* 将“状态变更权限”从硬编码提升为可配置模型
* 审批规则与能力组解耦
* 支持串行 / 并行 / 条件审批

Phase 2 将优先落地在：

* 物资计划审批
  或
* 付款申请审批

择一跑通，再扩展至全系统。

---

## 六、结语

Phase 1 并不是“功能阶段”，而是**系统范式确立阶段**。

从这一基线开始：

* 权限不再混乱
* 角色不再膨胀
* 业务扩展不再靠复制粘贴

这是一个可以被长期维护、重构、产品化的起点。
