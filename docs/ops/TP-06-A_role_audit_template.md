# TP-06-A｜角色视角审计记录模板

用途：
- 按角色验证“可见入口 = 可用入口”
- 固化问题发现 → 归因 → 决策
- 作为后续回归基线（B2）

## 一、角色基本信息（每个角色一页）

```text
角色名称：demo_pm
数据库：sc_demo
审计日期：YYYY-MM-DD
审计人：________
版本/分支：________
```

## 二、项目中心入口审计表（核心）

### 2.1 项目列表 / 看板视角

| 编号 | 场景 | 入口位置 | 入口名称 | 是否可见 | 是否可点 | 是否报错 | 实际表现 | 结论 | 归因类型 | 处理建议 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| A-01 | 看板 | 三点菜单 | 打开项目 | 是 | 是 | 否 | 正常进入详情页 | 通过 | — | — |
| A-02 | 看板 | 三点菜单 | 成本台账 | 是 | 是 | 是 | AccessError | 不通过 | action.groups 缺失 | 隐藏 / 降维 |
| A-03 | 列表 | 行点击 | 项目详情 | 是 | 是 | 否 | 正常 | 通过 | — | — |

归因类型枚举（统一用）：
- menu.groups
- action.groups
- view.groups
- model ACL
- record rule
- 计算字段越权
- 未定义（待分析）

### 2.2 项目详情页 – 页签审计

| 编号 | 页签 | 是否可见 | 是否可进入 | 是否报错 | 实际表现 | 结论 | 归因类型 | 处理建议 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| B-01 | 项目概览 | 是 | 是 | 否 | 正常 | 通过 | — | — |
| B-02 | 工程量清单 | 否 | — | — | 不展示 | 通过 | 视图隐藏 | 保持 |
| B-03 | 驾驶舱 | 是 | 是 | 否 | 只读指标 | 通过 | 计算字段守卫 | 保持 |
| B-04 | 合同 | 是 | 是 | 否 | 汇总只读 | 通过 | action 降维 | 保持 |

### 2.3 项目详情页 – 按钮 / 快捷入口

| 编号 | 区域 | 按钮名称 | 是否可见 | 是否可点 | 是否报错 | 实际行为 | 结论 | 归因类型 | 处理建议 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| C-01 | button_box | 预算/成本 | 是 | 是 | 否 | 打开汇总 | 通过 | 降维 action | 保持 |
| C-02 | button_box | 工程量清单 | 否 | — | — | 不展示 | 通过 | 视图控制 | 保持 |
| C-03 | 页内 | 查看台账明细 | 是 | 是 | 是 | AccessError | 不通过 | object 方法越权 | 隐藏 |

## 三、审计结论汇总（每角色）

```text
总入口数：XX
通过：XX
不通过：XX

主要问题类型：
- action.groups 缺失：X
- view.groups 不一致：X
- 模型 ACL 越权：X
- 计算字段越权：X
```

## 四、裁决记录（只记录结论）

| 问题编号 | 角色 | 入口 | 裁决结果 | 理由 |
| --- | --- | --- | --- | --- |
| A-02 | demo_pm | 成本台账 | 隐藏入口 | 不属于 PM 表达层 |
| C-03 | demo_pm | 查看台账明细 | 改为只读汇总 | 防止误点 |

## 五、阶段完成确认（TP-06）

```text
[ ] demo_pm：所有可见入口均可点击且无 AccessError
[ ] demo_cost：明细功能不回退
[ ] demo_readonly：仅摘要，无点炸
[ ] admin：原功能不受影响

TP-06 是否通过： □ 是 / □ 否
```
