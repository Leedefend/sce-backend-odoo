# Smart Construction · Odoo UI 使用边界白皮书（v1）

**版本**：v1.0  
**阶段**：Phase 8 · UI / 原生能力使用策略  
**适用对象**：系统架构师、核心开发者、产品负责人  
**定位**：系统级约束与长期演进边界定义文档

---

## 一、编写背景（为什么要有这本白皮书）

Smart Construction 并非一个“基于 Odoo 的简单定制系统”，而是：

> 一个 **以工程业务能力为核心、以 Odoo 为底座能力引擎** 的长期平台。

在 Phase7x 中，我们已经完成了：

- 能力模型基线（Capability Baseline）
- 权限 / 菜单 / 行为的系统收敛
- “最小可见能力面”的验证

随之而来的根本问题是：

> **Odoo 的 UI / 原生模块能力，到底应该如何被使用？**
>
> - 哪些应该“直接用”
> - 哪些只能“借用底层能力”
> - 哪些必须“彻底绕开”

如果不在此刻明确边界，系统将不可避免地走向：

- UI 形态混乱
- 权限语义分裂
- 后期前后端割裂成本指数级上升

---

## 二、核心设计原则（本白皮书的“宪法条款”）

### （新增）UI 不承载业务规则

- 禁止将关键业务规则仅实现于 attrs、domain、readonly 等 UI 层
- 所有影响业务正确性的判断，必须落在 Model / Validator / Service 层
- UI 限制仅可用于用户体验优化，不得作为唯一约束

### 原则 1：Odoo 是“能力引擎”，不是“产品外观”

Odoo 在 Smart Construction 中的定位是：

> **业务能力提供者（Capability Provider）**
>
> 而不是：
>
> - UI 体验定义者
> - 用户交互主权拥有者

因此：

- ✅ 使用 Odoo 的 **模型 / ORM / 工作流 / ACL / 审批机制**
- ⚠️ 谨慎使用 Odoo 的 **UI 结构**
- ❌ 不以 Odoo UI 作为最终产品形态

### 原则 2：UI 只是“能力入口”，不是能力本体

在 Smart Construction 中：

- **能力定义** = Model + Rule + Validator
- **能力入口** = Menu / Action / View
- **UI 页面** = 能力的一种“临时壳”

结论：

> **任何能力，必须在“脱离 Odoo UI 的情况下依然成立”。**

这也是 Phase7x 中我们严格做“最小菜单入口”的原因。

### 原则 3：原生 UI 的使用必须“可替换、可弃用”

凡是使用 Odoo 原生 UI 的地方，都必须满足：

- 不影响能力数据模型
- 不绑定复杂前端逻辑
- 不成为唯一操作路径

一句话：

> **今天能删，明天能换，后天能被自研前端完全接管。**

---

## 三、Odoo 原生 UI 的四级使用策略（核心章节）

这是整本白皮书的技术心脏。

### Level 0：系统级基础 UI（完全接受）

**范围**：

- 登录页
- 系统设置
- 用户 / 角色管理
- 模块安装
- 技术配置界面

**策略**：

- 完全使用 Odoo 原生
- 不做美化、不做重构
- 仅供系统管理员使用

**原因**：这些界面不属于“工程业务能力”，重写没有任何战略价值。

### Level 1：能力校验 / 管理型 UI（保留但收敛）

**典型场景**：

- 字典维护
- 审批流配置
- 能力规则配置
- 内部测试 / 验证入口

**策略**：

- 使用 Odoo 原生 form / tree
- 严格受 capability group 控制
- 不对外宣称为“产品 UI”

**当前系统中的例子**：

- sc.dictionary
- sc.workflow.*
- quota.import.wizard

### Level 2：业务操作型 UI（过渡使用，明确将被替换）

**典型场景**：

- 项目预算
- 合同台账
- 结算单
- 付款申请
- 物资计划

**策略**：

- 使用 Odoo 原生 UI 作为过渡壳
- 入口严格限制为 user / manager
- 不依赖 Odoo UI 特性（如复杂 domain、attrs 逻辑）
- 所有关键约束必须在后端 validator 中完成
- 退出条件（满足任一即可）：已有可用 API + 外部 UI 入口；该能力纳入统一产品级交互；原生 UI 仅保留为管理员备用入口

**Phase7x 已完成的关键动作**：

- 菜单只给 domain user/manager
- read 组不再暴露 UI
- UI ≠ 权限

### Level 3：产品级交互 UI（禁止使用 Odoo 原生）

**典型场景**：

- 项目驾驶舱
- 经营分析
- 跨项目汇总
- 高管视图
- 移动端

**策略**：

- ❌ 禁止依赖 Odoo 原生 UI
- 只能通过 API / service 层访问能力
- 未来由自研前端 / BI / 移动端承载

**现状说明**：当前 operating metrics 的 tree / pivot 是能力验证工具，不是最终产品形态。

---

## 四、关于“系统菜单 / 讨论 / 待办 / 仪表板”的统一处理策略

这些菜单的真实属性是：讨论（Discuss）、待办（Activities）、仪表板（Dashboard）、应用（Apps）。它们是 Odoo 平台级工具，不是业务能力。

**策略结论**：

- 不将其纳入 Smart Construction 能力体系
- 不主动删除（避免破坏平台）
- 通过角色与入口控制：普通业务用户不感知，管理员 / 架构师可使用

---

## 五、这是否意味着“所有能力都要自己造”？——明确否定

关键澄清：我们不是不用 Odoo 能力，而是不用 Odoo 的“主观 UI 叙事”。

我们用 Odoo 的 ORM、ACL、Workflow、Domain/Constraint，但不接受“菜单即产品、页面即能力、UI 即边界”的观念。这是一种“引擎式使用 Odoo”的成熟姿态。

---

## 六、对白皮书 v1 的明确边界声明

v1 不做的事情：

- 不设计具体前端
- 不重写任何 UI
- 不引入前后端分离实现

v1 只做一件事：

> **定义：什么可以用、什么只能暂用、什么绝对不用。**

---

## 七、Phase8 后续子阶段预告（不立即执行）

- Phase8-B：能力 API 主权设计
- Phase9：产品级前端接管策略
- Phase10：Odoo UI 逐步降级为“管理后台”

---

## 八、你现在该做的“唯一正确动作”

- 将本白皮书内容落为 `docs/phase8_ui_boundary/whitepaper_ui_boundary_v1.md`
- 不写代码
- 不 merge main
- 只讨论、只修文案、只达成共识

---

## 九、约束对象声明

本白皮书对以下行为具有约束力：

- 新增功能模块的 UI 设计
- 原生模块引入与裁剪决策
- 前端重构 / 独立前端的边界判断

对既有历史实现不做追溯性强制，但作为未来重构依据。
