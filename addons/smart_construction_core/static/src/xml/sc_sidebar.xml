<?xml version="1.0" encoding="UTF-8"?>
<templates id="sc_sidebar_templates" xml:space="preserve">
    <t t-name="smart_construction_core.ScSidebar">
        <t t-if="state.visible">
            <nav class="sc-sidebar" aria-label="主导航">
                <div class="sc-sidebar__header">
                    <span class="sc-sidebar__brandIcon" aria-hidden="true">
                        <img src="/smart_construction_core/static/png/system-icon-1.png" alt=""/>
                    </span>
                    <span class="sc-sidebar__brandText">智能施工</span>
                    <span class="sc-sidebar__brandTag">平台</span>
                </div>
                <t t-if="state.allowedCompanies.length &gt; 1">
                    <div class="sc-sidebar__company">
                        <button type="button"
                                class="sc-sidebar__companyButton"
                                t-on-click="toggleCompanyMenu"
                                t-att-aria-expanded="state.companyMenuOpen ? 'true' : 'false'">
                            <span class="sc-sidebar__companyLabel"><t t-esc="companyLabel"/></span>
                            <span class="sc-sidebar__chev" t-att-class="state.companyMenuOpen ? 'is-open' : ''">▾</span>
                        </button>
                        <div class="sc-sidebar__companyMenu" t-att-class="state.companyMenuOpen ? 'is-open' : ''">
                            <t t-foreach="state.allowedCompanies" t-as="company" t-key="company.id">
                                <label class="sc-sidebar__companyItem">
                                    <input type="checkbox"
                                           t-att-checked="state.selectedCompanyIds.includes(company.id) ? 'checked' : undefined"
                                           t-on-change="() => toggleCompanySelection(company.id)"/>
                                    <span class="sc-sidebar__companyName"><t t-esc="company.name"/></span>
                                </label>
                            </t>
                            <div class="sc-sidebar__companyActions">
                                <button type="button"
                                        class="sc-sidebar__companyApply"
                                        t-on-click.stop="applyCompanySelection">
                                    应用
                                </button>
                            </div>
                        </div>
                    </div>
                </t>
                <t t-if="state.debugMessage">
                    <div class="sc-sidebar__debug">
                        <t t-esc="state.debugMessage"/>
                    </div>
                </t>
                <div class="sc-sidebar__search">
                    <input type="text"
                           class="o_input sc-sidebar__searchInput"
                           placeholder="搜索..."
                           t-att-value="state.searchTerm"
                           t-on-input="onSearchInput"/>
                </div>
                <div class="sc-sidebar__body">
                    <t t-if="favoritesForRender.length">
                        <section class="sc-sidebar__section">
                            <div class="sc-sidebar__title sc-sidebar__title--meta">
                                <span class="sc-sidebar__titleText">收藏</span>
                                <button type="button"
                                        class="sc-sidebar__metaButton"
                                        t-on-click.stop="clearFavoriteMenus">
                                    清空
                                </button>
                            </div>
                            <div class="sc-sidebar__items">
                                <t t-foreach="favoritesForRender" t-as="fav" t-key="fav.menuId">
                                    <a class="sc-sidebar__item"
                                       t-att-class="fav.menuId === state.activeMenuId ? 'is-active' : ''"
                                       t-on-click.prevent="() => openMenu(fav.menuId, fav.actionId, fav.name)"
                                       t-attf-href="#menu_id=#{fav.menuId}&amp;action=#{fav.actionId}">
                                        <span class="sc-sidebar__itemLabel">
                                            <t t-if="fav._label">
                                                <t t-foreach="fav._label" t-as="token" t-key="token_index">
                                                    <span t-att-class="token.match ? 'sc-sidebar__highlight' : ''">
                                                        <t t-esc="token.text"/>
                                                    </span>
                                                </t>
                                            </t>
                                            <t t-else=""><t t-esc="fav.name"/></t>
                                        </span>
                                        <button type="button"
                                                class="sc-sidebar__favButton is-active"
                                                t-on-click.stop="() => toggleFavorite(fav.menuId, fav.actionId, fav.name)"
                                                aria-label="取消收藏">
                                            ★
                                        </button>
                                    </a>
                                </t>
                            </div>
                        </section>
                    </t>
                    <t t-if="recentForRender.length">
                        <section class="sc-sidebar__section">
                            <div class="sc-sidebar__title sc-sidebar__title--meta">
                                <span class="sc-sidebar__titleText">最近</span>
                                <button type="button"
                                        class="sc-sidebar__metaButton"
                                        t-on-click.stop="clearRecentMenus">
                                    清空
                                </button>
                            </div>
                            <div class="sc-sidebar__items">
                                <t t-foreach="recentForRender" t-as="recent" t-key="recent.menuId">
                                    <a class="sc-sidebar__item"
                                       t-att-class="recent.menuId === state.activeMenuId ? 'is-active' : ''"
                                       t-on-click.prevent="() => openMenu(recent.menuId, recent.actionId, recent.name)"
                                       t-attf-href="#menu_id=#{recent.menuId}&amp;action=#{recent.actionId}">
                                        <span class="sc-sidebar__itemLabel">
                                            <t t-if="recent._label">
                                                <t t-foreach="recent._label" t-as="token" t-key="token_index">
                                                    <span t-att-class="token.match ? 'sc-sidebar__highlight' : ''">
                                                        <t t-esc="token.text"/>
                                                    </span>
                                                </t>
                                            </t>
                                            <t t-else=""><t t-esc="recent.name"/></t>
                                        </span>
                                    </a>
                                </t>
                            </div>
                        </section>
                    </t>
                    <t t-foreach="sectionsForRender" t-as="section" t-key="section.id">
                        <section class="sc-sidebar__section">
                            <div class="sc-sidebar__title">
                                <button type="button"
                                        class="sc-sidebar__titleButton"
                                        t-on-click="() => onSectionTitleClick(section)">
                                    <span class="sc-sidebar__titleText">
                                        <t t-if="section._label">
                                            <t t-foreach="section._label" t-as="token" t-key="token_index">
                                                <span t-att-class="token.match ? 'sc-sidebar__highlight' : ''">
                                                    <t t-esc="token.text"/>
                                                </span>
                                            </t>
                                        </t>
                                        <t t-else=""><t t-esc="section.name"/></t>
                                    </span>
                                </button>
                                <button type="button"
                                        class="sc-sidebar__toggleButton"
                                        t-att-aria-expanded="section.isOpen || state.searchTerm ? 'true' : 'false'"
                                        t-on-click="() => toggleSection(section.id)"
                                        aria-label="展开或收起">
                                    <span class="sc-sidebar__chev" t-att-class="section.isOpen ? 'is-open' : ''">▸</span>
                                </button>
                            </div>
                            <div class="sc-sidebar__items"
                                 t-att-class="section.isOpen || state.searchTerm ? '' : 'is-collapsed'">
                                <t t-if="state.showOverview and section.actionId">
                                    <a class="sc-sidebar__item"
                                       t-att-class="section.id === state.activeMenuId ? 'is-active' : ''"
                                       t-on-click.prevent="() => openMenu(section.id, section.actionId, section.name)"
                                       t-attf-href="#menu_id=#{section.id}&amp;action=#{section.actionId}">
                                        <span class="sc-sidebar__itemLabel">概览</span>
                                        <button type="button"
                                                class="sc-sidebar__favButton"
                                                t-att-class="isFavorite(section.id) ? 'is-active' : ''"
                                                t-on-click.stop="() => toggleFavorite(section.id, section.actionId, section.name)"
                                                aria-label="收藏">
                                            ★
                                        </button>
                                    </a>
                                </t>
                                <t t-foreach="section.children" t-as="child" t-key="child.id">
                                    <a class="sc-sidebar__item sc-sidebar__item--child"
                                       t-att-class="child.id === state.activeMenuId ? 'is-active' : ''"
                                       t-on-click.prevent="() => openMenu(child.id, child.actionId, child.name)"
                                       t-attf-href="#menu_id=#{child.id}&amp;action=#{child.actionId}">
                                        <span class="sc-sidebar__itemLabel">
                                            <t t-if="child._label">
                                                <t t-foreach="child._label" t-as="token" t-key="token_index">
                                                    <span t-att-class="token.match ? 'sc-sidebar__highlight' : ''">
                                                        <t t-esc="token.text"/>
                                                    </span>
                                                </t>
                                            </t>
                                            <t t-else=""><t t-esc="child.name"/></t>
                                        </span>
                                        <button type="button"
                                                class="sc-sidebar__favButton"
                                                t-att-class="isFavorite(child.id) ? 'is-active' : ''"
                                                t-on-click.stop="() => toggleFavorite(child.id, child.actionId, child.name)"
                                                aria-label="收藏">
                                            ★
                                        </button>
                                    </a>
                                </t>
                            </div>
                        </section>
                    </t>
                </div>
            </nav>
        </t>
    </t>
</templates>
