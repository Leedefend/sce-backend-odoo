<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>

        <!-- 合同列表视图 -->
        <record id="view_project_contract_tree" model="ir.ui.view">
            <field name="name">project.contract.tree</field>
            <field name="model">project.contract</field>
            <field name="arch" type="xml">
                <tree string="合同台账">
                    <field name="name"/>
                    <field name="project_id"/>
                    <field name="contract_type"/>
                    <field name="partner_id"/>
                    <field name="amount_total"/>
                    <field name="currency_id" invisible="1"/>
                    <field name="active" invisible="1"/>
                </tree>
            </field>
        </record>

        <!-- 合同表单视图 -->
        <record id="view_project_contract_form" model="ir.ui.view">
            <field name="name">project.contract.form</field>
            <field name="model">project.contract</field>
            <field name="arch" type="xml">
                <form string="合同">
                    <sheet>
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="project_id"/>
                                <field name="contract_type"/>
                                <field name="partner_id"/>
                            </group>
                            <group>
                                <field name="currency_id"/>
                                <field name="amount_total"/>
                                <field name="date_start"/>
                                <field name="date_end"/>
                                <field name="active"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="合同行">
                                <field name="line_ids">
                                    <tree editable="bottom">
                                        <field name="sequence"/>
                                        <field name="name"/>
                                        <field name="boq_line_id"/>
                                        <field name="wbs_id"/>
                                        <field name="contract_qty"/>
                                        <field name="contract_price"/>
                                        <field name="contract_amount"/>
                                        <field name="currency_id" invisible="1"/>
                                    </tree>
                                </field>
                            </page>

                            <page string="备注">
                                <field name="note"/>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- 动作 -->
        <record id="action_project_contract" model="ir.actions.act_window">
            <field name="name">合同台账</field>
            <field name="res_model">project.contract</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{}</field>
            <field name="groups_id" eval="[
                (4, ref('smart_construction_core.group_sc_cap_contract_user')),
                (4, ref('smart_construction_core.group_sc_cap_contract_manager'))
            ]"/>
        </record>

        <!-- 顶层菜单：调整到模块合同中心 -->
        <menuitem id="menu_project_contract_root"
                  name="合同管理"
                  parent="smart_construction_core.menu_sc_contract_center"
                  sequence="40"
                  groups="smart_construction_core.group_sc_cap_contract_user,smart_construction_core.group_sc_cap_contract_manager"/>

        <!-- 子菜单：合同台账 -->
        <menuitem id="menu_project_contract"
                  name="合同台账"
                  parent="menu_project_contract_root"
                  action="action_project_contract"
                  sequence="10"
                  groups="smart_construction_core.group_sc_cap_contract_user,smart_construction_core.group_sc_cap_contract_manager"/>
    </data>
</odoo>
