<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Workflow Definition -->
    <record id="view_sc_workflow_def_tree" model="ir.ui.view">
        <field name="name">sc.workflow.def.tree</field>
        <field name="model">sc.workflow.def</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name"/>
                <field name="code"/>
                <field name="model_name"/>
                <field name="trigger"/>
                <field name="state"/>
                <field name="active"/>
                <field name="instance_count" widget="statinfo" string="Instances"/>
            </tree>
        </field>
    </record>

    <record id="view_sc_workflow_def_form" model="ir.ui.view">
        <field name="name">sc.workflow.def.form</field>
        <field name="model">sc.workflow.def</field>
        <field name="arch" type="xml">
            <form string="Workflow Definition">
                <header>
                    <button name="action_publish" type="object" string="发布" class="oe_highlight"
                            invisible="state != 'draft'"/>
                    <button name="action_draft" type="object" string="回到草稿" class="btn-secondary"
                            invisible="state != 'published'"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,published"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name" string="名称"/>
                            <field name="code" string="编码"/>
                            <field name="active" string="启用"/>
                        </group>
                        <group>
                            <field name="model_name" string="目标模型"/>
                            <field name="trigger" string="触发器"/>
                            <field name="start_node_id" string="起始节点"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="节点">
                            <field name="node_ids">
                                <tree editable="bottom">
                                    <field name="workflow_def_id" invisible="1"/>
                                    <field name="name" string="名称"/>
                                    <field name="code" string="编码"/>
                                    <field name="sequence" string="顺序"/>
                                    <field name="node_type" string="节点类型"/>
                                    <field name="approve_group_id" string="审批组"/>
                                    <field name="next_node_id" string="下一节点"/>
                                    <field name="reject_node_id" string="驳回到"/>
                                    <field name="active" string="启用"/>
                                </tree>
                            </field>
                        </page>
                        <page string="统计">
                            <group>
                                <field name="instance_count" readonly="1" string="实例数量"/>
                            </group>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Workflow Node -->
    <record id="view_sc_workflow_node_tree" model="ir.ui.view">
        <field name="name">sc.workflow.node.tree</field>
        <field name="model">sc.workflow.node</field>
        <field name="arch" type="xml">
            <tree>
                <field name="workflow_def_id" string="工作流定义"/>
                <field name="name" string="名称"/>
                <field name="code" string="编码"/>
                <field name="sequence" string="顺序"/>
                <field name="node_type" string="节点类型"/>
                <field name="approve_group_id" string="审批组"/>
                <field name="next_node_id" string="下一节点"/>
                <field name="reject_node_id" string="驳回到"/>
                <field name="active" string="启用"/>
            </tree>
        </field>
    </record>

    <record id="view_sc_workflow_node_form" model="ir.ui.view">
        <field name="name">sc.workflow.node.form</field>
        <field name="model">sc.workflow.node</field>
        <field name="arch" type="xml">
            <form string="Workflow Node">
                <sheet>
                    <group>
                        <group>
                            <field name="workflow_def_id" string="工作流定义"/>
                            <field name="name" string="名称"/>
                            <field name="code" string="编码"/>
                            <field name="sequence" string="顺序"/>
                        </group>
                        <group>
                            <field name="node_type" string="节点类型"/>
                            <field name="approve_group_id" string="审批组"/>
                            <field name="next_node_id" string="下一节点"/>
                            <field name="reject_node_id" string="驳回到"/>
                            <field name="active" string="启用"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Workflow Instance -->
    <record id="view_sc_workflow_instance_tree" model="ir.ui.view">
        <field name="name">sc.workflow.instance.tree</field>
        <field name="model">sc.workflow.instance</field>
        <field name="arch" type="xml">
            <tree>
                <field name="name" string="实例"/>
                <field name="workflow_def_id" string="工作流定义"/>
                <field name="model_name" string="模型"/>
                <field name="res_id" string="资源ID"/>
                <field name="state" string="状态"/>
                <field name="current_node_id" string="当前节点"/>
                <field name="submitter_id" string="提交人"/>
                <field name="submitted_at" string="提交时间"/>
                <field name="finished_at" string="完成时间"/>
            </tree>
        </field>
    </record>

    <record id="view_sc_workflow_instance_form" model="ir.ui.view">
        <field name="name">sc.workflow.instance.form</field>
        <field name="model">sc.workflow.instance</field>
        <field name="arch" type="xml">
            <form string="Workflow Instance">
                <header>
                    <button name="action_submit" type="object" string="提交" class="oe_highlight"
                            invisible="state != 'draft'"/>
                    <button name="action_approve" type="object" string="审批通过" class="btn-primary"
                            invisible="state != 'running'"/>
                    <button name="action_reject" type="object" string="驳回" class="btn-secondary"
                            invisible="state != 'running'"/>
                    <button name="action_cancel" type="object" string="取消" class="btn-secondary"
                            invisible="state not in ['draft','running']"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,running,done,rejected,cancelled"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="workflow_def_id"/>
                            <field name="name" readonly="1" string="实例"/>
                            <field name="model_name" string="模型"/>
                            <field name="res_id" string="资源ID"/>
                        </group>
                        <group>
                            <field name="current_node_id" string="当前节点"/>
                            <field name="submitter_id" readonly="1" string="提交人"/>
                            <field name="submitted_at" readonly="1" string="提交时间"/>
                            <field name="finished_at" readonly="1" string="完成时间"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="待办">
                            <field name="workitem_ids" readonly="1">
                                <tree>
                                    <field name="node_id" string="节点"/>
                                    <field name="assignee_group_id" string="分配组"/>
                                    <field name="assignee_id" string="分配用户"/>
                                    <field name="status" string="状态"/>
                                    <field name="created_at" string="创建时间"/>
                                    <field name="done_by" string="处理人"/>
                                    <field name="done_at" string="处理时间"/>
                                </tree>
                            </field>
                        </page>
                        <page string="日志">
                            <field name="log_ids" readonly="1">
                                <tree>
                                    <field name="action" string="动作"/>
                                    <field name="from_state" string="来源状态"/>
                                    <field name="to_state" string="目标状态"/>
                                    <field name="from_node_id" string="来源节点"/>
                                    <field name="to_node_id" string="目标节点"/>
                                    <field name="actor_id" string="执行人"/>
                                    <field name="note" string="备注"/>
                                    <field name="created_at" string="时间"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Workitem -->
    <record id="view_sc_workflow_workitem_tree" model="ir.ui.view">
        <field name="name">sc.workflow.workitem.tree</field>
        <field name="model">sc.workflow.workitem</field>
        <field name="arch" type="xml">
            <tree>
                <field name="instance_id" string="实例"/>
                <field name="node_id" string="节点"/>
                <field name="assignee_group_id" string="分配组"/>
                <field name="assignee_id" string="分配用户"/>
                <field name="status" string="状态"/>
                <field name="created_at" string="创建时间"/>
                <field name="done_by" string="处理人"/>
                <field name="done_at" string="处理时间"/>
            </tree>
        </field>
    </record>

    <!-- Log -->
    <record id="view_sc_workflow_log_tree" model="ir.ui.view">
        <field name="name">sc.workflow.log.tree</field>
        <field name="model">sc.workflow.log</field>
        <field name="arch" type="xml">
            <tree>
                <field name="instance_id" string="实例"/>
                <field name="action" string="动作"/>
                <field name="from_state" string="来源状态"/>
                <field name="to_state" string="目标状态"/>
                <field name="from_node_id" string="来源节点"/>
                <field name="to_node_id" string="目标节点"/>
                <field name="actor_id" string="执行人"/>
                <field name="note" string="备注"/>
                <field name="created_at" string="时间"/>
            </tree>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_sc_workflow_def" model="ir.actions.act_window">
        <field name="name">工作流定义</field>
        <field name="res_model">sc.workflow.def</field>
        <field name="view_mode">tree,form</field>
        <field name="groups_id" eval="[(4, ref('smart_construction_core.group_sc_cap_config_admin'))]"/>
    </record>

    <record id="action_sc_workflow_instance" model="ir.actions.act_window">
        <field name="name">工作流实例</field>
        <field name="res_model">sc.workflow.instance</field>
        <field name="view_mode">tree,form</field>
        <field name="groups_id" eval="[(4, ref('smart_construction_core.group_sc_cap_config_admin'))]"/>
    </record>

    <record id="action_sc_workflow_workitem" model="ir.actions.act_window">
        <field name="name">工作项</field>
        <field name="res_model">sc.workflow.workitem</field>
        <field name="view_mode">tree</field>
        <field name="groups_id" eval="[(4, ref('smart_construction_core.group_sc_cap_config_admin'))]"/>
    </record>

    <record id="action_sc_workflow_log" model="ir.actions.act_window">
        <field name="name">工作流日志</field>
        <field name="res_model">sc.workflow.log</field>
        <field name="view_mode">tree</field>
        <field name="groups_id" eval="[(4, ref('smart_construction_core.group_sc_cap_config_admin'))]"/>
    </record>
</odoo>
