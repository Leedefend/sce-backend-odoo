<odoo>
    <record id="view_project_project_kanban_dashboard" model="ir.ui.view">
        <field name="name">project.project.kanban.dashboard</field>
        <field name="model">project.project</field>
        <field name="arch" type="xml">
            <kanban sample="0"
                    class="sc_project_dashboard_kanban o_kanban_small">
                <field name="name"/>
                <field name="project_code"/>
                <field name="stage_id"/>
                <field name="manager_id"/>
                <field name="owner_id"/>
                <field name="location"/>
                <field name="contract_no"/>
                <field name="lifecycle_state"/>
                <field name="phase_key"/>
                <field name="plan_percent"/>
                <field name="actual_percent"/>
                <field name="document_missing_count"/>
                <field name="document_required_count"/>

                <field name="dashboard_revenue_actual" groups="account.group_account_readonly"/>
                <field name="dashboard_cost_actual" groups="account.group_account_readonly"/>
                <field name="dashboard_profit_actual" groups="account.group_account_readonly"/>
                <field name="dashboard_invoice_amount" groups="account.group_account_readonly"/>
                <field name="dashboard_payment_in" groups="account.group_account_readonly"/>
                <field name="dashboard_payment_out" groups="account.group_account_readonly"/>

                <field name="budget_active_cost_target"/>
                <field name="budget_active_revenue_target"/>
                <field name="cost_ledger_amount_actual"/>
                <field name="cost_budget_gap"/>

                <field name="dashboard_progress_rate"/>
                <field name="document_completion_rate"/>

                <templates>
                    <t t-name="kanban-box">
                        <t t-set="progress_raw" t-value="+(record.dashboard_progress_rate.raw_value or 0)"/>
                        <t t-set="progress_clamped" t-value="Math.min(Math.max(progress_raw, 0.0), 100.0)"/>
                        <t t-set="dashoffset" t-value="100 - progress_clamped"/>

                        <t t-set="doc_rate_raw" t-value="+(record.document_completion_rate.raw_value or 0)"/>
                        <t t-set="doc_rate_clamped" t-value="Math.min(Math.max(doc_rate_raw, 0.0), 100.0)"/>
                        <t t-set="doc_missing" t-value="+(record.document_missing_count.raw_value || 0)"/>
                        <t t-set="doc_required" t-value="+(record.document_required_count.raw_value || 0)"/>

                        <t t-set="plan_rate_raw" t-value="+(record.plan_percent.raw_value or 0)"/>
                        <t t-set="plan_rate_clamped" t-value="Math.min(Math.max(plan_rate_raw, 0.0), 100.0)"/>

                        <t t-set="gap" t-value="+(record.cost_budget_gap.raw_value or 0.0)"/>
                        <t t-set="budget_target" t-value="+(record.budget_active_cost_target.raw_value or 0.0)"/>
                        <t t-set="risk_class"
                           t-value="gap &lt; 0 and 'sc_risk_high'
                                    or (gap &lt;= budget_target * 0.1 and 'sc_risk_warn'
                                        or 'sc_risk_ok')"/>
                        <t t-set="progress_gap" t-value="progress_clamped - plan_rate_clamped"/>
                        <t t-set="cost_target_val" t-value="+(record.budget_active_cost_target.raw_value || 0)"/>
                        <t t-set="cost_committed_val" t-value="+(record.cost_ledger_amount_actual.raw_value || 0)"/>
                        <t t-set="cost_actual_val" t-value="+(record.dashboard_cost_actual.raw_value || 0)"/>
                        <t t-set="cost_variance_val" t-value="+(record.cost_budget_gap.raw_value || 0)"/>
                        <t t-set="pct_commit" t-value="cost_target_val ? Math.min(Math.round(cost_committed_val / cost_target_val * 100), 200) : 0"/>
                        <t t-set="pct_actual" t-value="cost_target_val ? Math.min(Math.round(cost_actual_val / cost_target_val * 100), 200) : 0"/>

                        <div t-attf-class="o_kanban_record sc_project_card {{ risk_class }}">
                            <div class="sc-card-header">
                                <div class="sc-title-row">
                                    <div class="sc-title-main">
                                        <span class="sc-project-name" t-esc="record.name.value or ''"/>
                                        <span class="sc-project-code" t-esc="record.project_code.value or ''"/>
                                    </div>
                                    <div class="sc-title-status">
                                        <t t-if="risk_class == 'sc_risk_high'"><span class="sc-badge-icon sc-badge-high">üî¥</span></t>
                                        <t t-if="risk_class == 'sc_risk_warn'"><span class="sc-badge-icon sc-badge-warn">üü†</span></t>
                                        <t t-if="risk_class == 'sc_risk_ok'"><span class="sc-badge-icon sc-badge-ok">üü¢</span></t>
                                    </div>
                                </div>
                                <div class="sc-meta-row">
                                    <span class="sc-pill" t-if="record.stage_id.value">
                                        <t t-esc="record.stage_id.value"/>
                                    </span>
                                    <span class="sc-pill light" t-if="record.lifecycle_state.value">
                                        <t t-esc="record.lifecycle_state.value"/>
                                    </span>
                                    <span class="sc-pill light" t-if="record.phase_key.value">
                                        <t t-esc="record.phase_key.value"/>
                                    </span>
                                    <span class="sc-manager" t-if="record.manager_id.value">
                                        üë§ <t t-esc="record.manager_id.value"/>
                                    </span>
                                    <span class="sc-location" t-if="record.location.value">
                                        üìç <t t-esc="record.location.value"/>
                                    </span>
                                </div>
                            </div>

                            <div class="sc-card-body">
                                <div class="sc-kpi-grid">
                                    <div class="sc-kpi-card">
                                        <span class="label">ÁõÆÊ†áÊàêÊú¨</span>
                                        <span class="value" t-esc="record.budget_active_cost_target.value or '‚Äî'"/>
                                    </div>
                                    <div class="sc-kpi-card">
                                        <span class="label">ÊâøËØ∫ÊàêÊú¨</span>
                                        <span class="value" t-esc="record.cost_ledger_amount_actual.value or '‚Äî'"/>
                                    </div>
                                    <div class="sc-kpi-card">
                                        <span class="label">ÂÆûÈôÖÊàêÊú¨</span>
                                        <span class="value" t-esc="record.dashboard_cost_actual and (record.dashboard_cost_actual.value || '0.00') || '‚Äî'"/>
                                    </div>
                                    <div class="sc-kpi-card variance">
                                        <span class="label">ÊàêÊú¨ÂÅèÂ∑Æ</span>
                                        <span class="value" t-esc="record.cost_budget_gap.value or '0.00'"/>
                                    </div>
                                </div>

                                <div class="sc-bar-block">
                                    <div class="sc-bar-title">ÊàêÊú¨ËøõÂ∫¶</div>
                                    <div class="sc-bar-row">
                                        <span>È¢ÑÁÆó</span>
                                        <div class="sc-bar">
                                            <div class="sc-bar-fill budget" style="width:100%"></div>
                                        </div>
                                        <span class="sc-bar-num" t-esc="record.budget_active_cost_target.value or '‚Äî'"/>
                                    </div>
                                    <div class="sc-bar-row">
                                        <span>ÊâøËØ∫</span>
                                        <div class="sc-bar">
                                            <div class="sc-bar-fill commit" t-att-style="'width:' + Math.min(pct_commit,100) + '%;'"/>
                                        </div>
                                        <span class="sc-bar-num" t-esc="record.cost_ledger_amount_actual.value or '‚Äî'"/>
                                    </div>
                                    <div class="sc-bar-row">
                                        <span>ÂÆûÈôÖ</span>
                                        <div class="sc-bar">
                                            <div class="sc-bar-fill actual" t-att-style="'width:' + Math.min(pct_actual,100) + '%;'"/>
                                        </div>
                                        <span class="sc-bar-num" t-esc="record.dashboard_cost_actual and (record.dashboard_cost_actual.value || '0.00') || '‚Äî'"/>
                                    </div>
                                </div>
                            </div>

                            <div class="sc-progress-compare">
                                <div class="sc-progress-row">
                                    <span>ËÆ°ÂàíÂÆåÊàêÁéá</span>
                                    <div class="sc-progress-line">
                                        <div class="fill plan" t-att-style="'width:' + Math.min(plan_rate_clamped || 0,100) + '%;'"></div>
                                    </div>
                                    <span class="num" t-esc="plan_rate_clamped ? Math.round(plan_rate_clamped) + '%' : '‚Äî'"/>
                                </div>
                                <div class="sc-progress-row">
                                    <span>ÂÆûÈôÖÂÆåÊàêÁéá</span>
                                    <div class="sc-progress-line">
                                        <div class="fill actual" t-att-style="'width:' + Math.min(progress_clamped || 0,100) + '%;'"></div>
                                    </div>
                                    <span class="num" t-esc="Math.round(progress_clamped || 0) + '%'"/>
                                </div>
                            </div>

                            <div class="sc-alerts">
                                <div class="sc-alert" t-if="cost_target_val &gt; 0 and cost_actual_val &gt; cost_target_val * 0.85">
                                    ‚ö† ÂÆûÈôÖÊàêÊú¨Â∑≤Ëææ <t t-esc="Math.round(cost_actual_val / cost_target_val * 100)"/>% È¢ÑÁÆó
                                </div>
                                <div class="sc-alert" t-if="plan_rate_clamped and progress_gap &lt; -15">
                                    ‚ö† ËøõÂ∫¶ËêΩÂêé <t t-esc="Math.abs(Math.round(progress_gap))"/>%
                                </div>
                                <div class="sc-alert info" t-if="doc_missing">
                                    ‚Ñπ ËµÑÊñôÁº∫Âè£ <t t-esc="doc_missing"/>/<t t-esc="doc_required or '-'"/>
                                </div>
                            </div>

                            <div class="sc-card-footer">
                                <div class="sc-footer-left">
                                    <div t-if="record.contract_no.value">
                                        üìÑ ÂêàÂêå <t t-esc="record.contract_no.value"/>
                                    </div>
                                    <div t-if="record.owner_id.value">
                                        ü§ù ‰∏ö‰∏ª <t t-esc="record.owner_id.value"/>
                                    </div>
                                </div>
                                <div class="sc-footer-right">
                                    <div class="sc-footer-row">
                                        <span class="sc-footer-label">ÂºÄÁ•®</span>
                                        <span class="sc-footer-value"
                                              t-esc="record.dashboard_invoice_amount and (record.dashboard_invoice_amount.value || '0.00') || '‚Äî'"/>
                                    </div>
                                    <div class="sc-footer-row">
                                        <span class="sc-footer-label">Êî∂Ê¨æ</span>
                                        <span class="sc-footer-value"
                                              t-esc="record.dashboard_payment_in and (record.dashboard_payment_in.value || '0.00') || '‚Äî'"/>
                                    </div>
                                    <div class="sc-footer-row">
                                        <span class="sc-footer-label">‰ªòÊ¨æ</span>
                                        <span class="sc-footer-value"
                                              t-esc="record.dashboard_payment_out and (record.dashboard_payment_out.value || '0.00') || '‚Äî'"/>
                                    </div>
                                    <div class="sc-footer-row">
                                        <span class="sc-footer-label">ËµÑÊñô</span>
                                        <span class="sc-footer-value"
                                              t-esc="doc_rate_clamped ? (Math.round(doc_rate_clamped || 0) + '%') : '‚Äî'"/>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>

                <style>
                    .sc_project_dashboard_kanban .sc_project_card{
                        border-radius: 14px;
                        box-shadow: 0 10px 30px rgba(17,24,39,.12);
                        padding: 14px 14px 12px;
                        border-left: 5px solid #7159c1;
                        display: flex;
                        flex-direction: column;
                        gap: 12px;
                        min-height: 200px;
                        background: linear-gradient(180deg, #ffffff 0%, #f8fafc 100%);
                        border: 1px solid #e5e7eb;
                        position: relative;
                        box-sizing: border-box;
                        max-width: 430px;
                    }
                    .sc_project_dashboard_kanban .sc_project_card.sc_risk_high{
                        border-left-color: #e74c3c;
                    }
                    .sc_project_dashboard_kanban .sc_project_card.sc_risk_warn{
                        border-left-color: #f39c12;
                    }
                    .sc-card-header{
                        display:flex;
                        flex-direction: column;
                        gap:8px;
                    }
                    .sc-title-row{
                        display:flex;
                        justify-content:space-between;
                        align-items:center;
                        gap:10px;
                    }
                    .sc-title-main{
                        display:flex;
                        gap:8px;
                        align-items:center;
                        flex:1 1 auto;
                        min-width:0;
                    }
                    .sc-project-name{
                        font-size:16px;
                        font-weight:700;
                        color:#0f172a;
                        flex:1 1 auto;
                        line-height:1.2;
                        white-space:nowrap;
                        overflow:hidden;
                        text-overflow:ellipsis;
                    }
                    .sc-project-code{
                        font-size:12px;
                        color:#64748b;
                        white-space:nowrap;
                        padding:2px 8px;
                        border-radius:12px;
                        background:#eef2ff;
                        border:1px solid #e0e7ff;
                    }
                    .sc-meta-row{
                        display:flex;
                        gap:8px;
                        font-size:11px;
                        color:#475569;
                        flex-wrap:wrap;
                    }
                    .sc-card-body{
                        display:grid;
                        grid-template-columns: 1.5fr 0.9fr;
                        gap:12px;
                        align-items:start;
                    }
                    .sc-kpi-block{
                        display:grid;
                        grid-template-columns:repeat(2, minmax(0, 1fr));
                        gap:8px;
                        font-size:12px;
                    }
                    .sc-kpi-card{
                        display:flex;
                        flex-direction:column;
                        gap:4px;
                        background:#ffffff;
                        border:1px solid #e2e8f0;
                        border-radius:10px;
                        padding:10px 12px;
                        box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
                    }
                    .sc-kpi-card .label{
                        color:#475569;
                        font-size:11px;
                    }
                    .sc-kpi-card .value{
                        color:#0f172a;
                        font-weight:800;
                        font-size:15px;
                    }
                    .sc-kpi-card.variance .value{
                        color:#e11d48;
                    }
                    .sc-progress-block{
                        display:flex;
                        flex-direction:column;
                        align-items:center;
                        font-size:11px;
                        color:#1f2937;
                        text-align:center;
                        background:#ffffff;
                        border:1px solid #e2e8f0;
                        border-radius:12px;
                        padding:12px 10px;
                        gap:6px;
                        box-shadow: inset 0 1px 0 rgba(255,255,255,.9);
                    }
                    .sc-card-footer{
                        display:grid;
                        grid-template-columns:1fr 1fr;
                        gap:10px;
                        border-top:1px solid #e5e7eb;
                        padding-top:10px;
                        font-size:11px;
                        color:#475569;
                    }
                    .sc-footer-left{
                        display:flex;
                        flex-direction:column;
                        gap:4px;
                    }
                    .sc-footer-right{
                        display:grid;
                        grid-template-columns:repeat(2, auto);
                        gap:6px 12px;
                    }
                    .sc-footer-row{
                        display:flex;
                        justify-content:space-between;
                        gap:4px;
                    }
                    .sc-footer-label{
                        color:#94a3b8;
                    }
                    .sc-footer-value{
                        font-weight:700;
                        color:#0f172a;
                    }
                    .sc-badge-icon {
                        position: absolute;
                        top: 12px;
                        right: 12px;
                        font-size: 15px;
                    }
                </style>
            </kanban>
        </field>
    </record>

    <record id="action_project_dashboard" model="ir.actions.act_window">
        <field name="name">È°πÁõÆÈ©æÈ©∂Ëà±</field>
        <field name="res_model">project.project</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="view_id" ref="view_project_project_kanban_dashboard"/>
        <field name="context">{}</field>
        <field name="domain">[]</field>
        <field name="groups_id" eval="[(4, ref('smart_construction_core.group_sc_cap_project_read'))]"/>
    </record>
</odoo>
