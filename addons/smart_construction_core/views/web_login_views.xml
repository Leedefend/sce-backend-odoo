<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="sc_web_login_disable_footer" inherit_id="web.login" priority="1000">
        <xpath expr="//t[@t-call='web.login_layout']" position="before">
            <t t-set="disable_footer" t-value="True"/>
            <t t-set="disable_database_manager" t-value="True"/>
        </xpath>
    </template>

    <template id="sc_web_login_inherit" inherit_id="web.login">
        <xpath expr="//form" position="before">
            <t t-if="request.env['ir.config_parameter'].sudo().get_param('sc.login.custom_enabled', '1') in ('1','true','True')">
                <t t-set="sc_login_env"
                   t-value="request.env['ir.config_parameter'].sudo().get_param('sc.login.env', 'prod')"/>
                <div class="sc-login-brand">
                    <img class="sc-login-brand-logo" src="/smart_construction_core/static/png/system-icon-1.png" alt="Smart Construction"/>
                    <div class="sc-login-title">智能工程项目管理系统</div>
                    <div class="sc-login-subtitle">工程全链路协同平台 · 项目 · 合同 · 结算 · 支付</div>
                </div>
                <t t-if="sc_login_env == 'demo'">
                    <div class="sc-login-env-badge is-demo">DEMO 环境</div>
                </t>
            </t>
        </xpath>
        <xpath expr="//form" position="attributes">
            <attribute name="class">oe_login_form sc-login-form</attribute>
        </xpath>
        <xpath expr="//form//div[.//input[@name='db']]" position="attributes">
            <attribute name="t-if">
                not (
                request.env['ir.config_parameter'].sudo().get_param('sc.login.custom_enabled', '1') in ('1','true','True')
                and request.env['ir.config_parameter'].sudo().get_param('sc.login.env', 'prod') in ('demo','prod')
                )
            </attribute>
        </xpath>

        <xpath expr="//form//input[@name='redirect']" position="attributes">
            <attribute name="t-att-value">
                request.params.get('redirect')
                or (
                request.env['ir.config_parameter'].sudo().get_param('sc.login.custom_enabled', '1') in ('1','true','True')
                and '/web#menu_id=%s&amp;action=%s' % (
                    request.env.ref('smart_construction_core.menu_sc_root').id,
                    request.env.ref('smart_construction_core.action_sc_project_workbench').id
                )
                )
                or ''
            </attribute>
        </xpath>
    </template>

    <template id="sc_web_layout_branding" inherit_id="web.layout">
        <xpath expr="//head/title" position="replace">
            <title>智能工程项目管理系统</title>
        </xpath>
        <xpath expr="//head" position="inside">
            <link rel="icon" type="image/png" href="/smart_construction_core/static/png/system-icon-1.png"/>
        </xpath>
    </template>

    <template id="sc_web_login_layout_inherit" inherit_id="web.login_layout">
        <xpath expr="//t[@t-call='web.frontend_layout']" position="inside">
            <t t-set="disable_footer" t-value="True"/>
            <t t-set="disable_database_manager" t-value="True"/>
        </xpath>
        <xpath expr="//div[hasclass('text-center') and hasclass('border-bottom')]" position="replace"/>
        <xpath expr="//div[@class='container py-5']" position="attributes">
            <attribute name="class">container py-5 sc-login-wrap</attribute>
        </xpath>
        <xpath expr="//div[contains(@class,'o_database_list')]" position="attributes">
            <attribute name="t-attf-class">card border-0 mx-auto bg-100 {{login_card_classes}} o_database_list sc-login-card</attribute>
            <attribute name="style">max-width: 420px;</attribute>
        </xpath>
        <xpath expr="//a[@href='/web/database/manager']" position="attributes">
            <attribute name="t-if">
                not (
                request.env['ir.config_parameter'].sudo().get_param('sc.login.custom_enabled', '1') in ('1','true','True')
                and request.env['ir.config_parameter'].sudo().get_param('sc.login.env', 'prod') in ('demo','prod')
                )
            </attribute>
        </xpath>
    </template>
</odoo>
