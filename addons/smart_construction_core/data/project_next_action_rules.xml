<?xml version="1.0" encoding="utf-8"?>
<odoo noupdate="1">
    <!-- Draft stage rules -->
    <record id="sc_next_action_submit_project" model="sc.project.next_action.rule">
        <field name="name">提交立项</field>
        <field name="lifecycle_state">draft</field>
        <field name="sequence">10</field>
        <field name="action_type">object_method</field>
        <field name="action_ref">action_sc_submit</field>
        <field name="condition_expr">
            u.has_group('smart_construction_core.group_sc_cap_project_user')
            or u.has_group('smart_construction_core.group_sc_cap_project_manager')
            or u.has_group('smart_construction_core.group_sc_super_admin')
        </field>
    </record>

    <record id="sc_next_action_create_contract" model="sc.project.next_action.rule">
        <field name="name">创建合同</field>
        <field name="lifecycle_state">draft</field>
        <field name="sequence">20</field>
        <field name="action_type">act_window_xmlid</field>
        <field name="action_ref">smart_construction_core.action_construction_contract_my</field>
        <field name="condition_expr">s.get('contract', {}).get('count', 0) == 0</field>
    </record>

    <record id="sc_next_action_complete_info" model="sc.project.next_action.rule">
        <field name="name">完善项目信息</field>
        <field name="lifecycle_state">draft</field>
        <field name="sequence">30</field>
        <field name="action_type">act_window_xmlid</field>
        <field name="action_ref">smart_construction_core.action_sc_project_manage</field>
        <field name="condition_expr">(not p.owner_id) or (not p.location)</field>
    </record>

    <record id="sc_next_action_assign_owner" model="sc.project.next_action.rule">
        <field name="name">指派负责人</field>
        <field name="lifecycle_state">draft</field>
        <field name="sequence">40</field>
        <field name="action_type">act_window_xmlid</field>
        <field name="action_ref">smart_construction_core.action_sc_project_manage</field>
        <field name="condition_expr">(p.owner_id and p.location) and (not p.user_id and not p.manager_id)</field>
    </record>

    <!-- In progress rules -->
    <record id="sc_next_action_handle_payment" model="sc.project.next_action.rule">
        <field name="name">处理待审批付款</field>
        <field name="lifecycle_state">in_progress</field>
        <field name="sequence">10</field>
        <field name="action_type">act_window_xmlid</field>
        <field name="action_ref">smart_construction_core.action_payment_request_my</field>
        <field name="condition_expr">s.get('payment', {}).get('pending', 0) &gt; 0</field>
        <field name="hint_template">待审批 {payment_pending} 笔</field>
    </record>

    <record id="sc_next_action_update_cost" model="sc.project.next_action.rule">
        <field name="name">维护成本台账</field>
        <field name="lifecycle_state">in_progress</field>
        <field name="sequence">20</field>
        <field name="action_type">act_window_xmlid</field>
        <field name="action_ref">smart_construction_core.action_project_cost_ledger_my</field>
        <field name="condition_expr">s.get('cost', {}).get('count', 0) == 0</field>
    </record>

    <record id="sc_next_action_push_task" model="sc.project.next_action.rule">
        <field name="name">推进任务执行</field>
        <field name="lifecycle_state">in_progress</field>
        <field name="sequence">30</field>
        <field name="action_type">object_method</field>
        <field name="action_ref">action_view_my_tasks</field>
        <field name="condition_expr">s.get('task', {}).get('in_progress', 0) &gt; 0</field>
        <field name="hint_template">进行中 {task_in_progress} 项</field>
    </record>

    <record id="sc_next_action_create_task" model="sc.project.next_action.rule">
        <field name="name">创建任务</field>
        <field name="lifecycle_state">in_progress</field>
        <field name="sequence">40</field>
        <field name="action_type">object_method</field>
        <field name="action_ref">action_view_my_tasks</field>
        <field name="condition_expr">s.get('task', {}).get('count', 0) == 0 and s.get('task', {}).get('in_progress', 0) == 0</field>
    </record>
</odoo>
